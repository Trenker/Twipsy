/* Twipsy for mootools | (c) 2012 by Georg Gro√überger | Apache License 2.0 */
(function(a,b,c){var d=function(b){return a[b]||a.getElementsByTagName(b)[0]},e=function(a,b,c){return typeof a=="function"?a.apply(b,c):a},f=null,g=!1,h=function(){if(!g){g=!0;var a=".twipsy { display: block; position: absolute; visibility: visible; padding: 5px; font-size: 11px; z-index: 1000; filter: alpha(opacity=80); -khtml-opacity: 0.8; -moz-opacity: 0.8; opacity: 0.8;}\t\t\t\t\t .twipsy-fade { -webkit-transition: opacity 0.15s linear;-moz-transition: opacity 0.15s linear;-ms-transition: opacity 0.15s linear;-o-transition: opacity 0.15s linear;transition: opacity 0.15s linear;opacity: 0;} \t\t\t\t\t .twipsy.twipsy-fade.twipsy-in { filter: alpha(opacity=80); -khtml-opacity: 0.8; -moz-opacity: 0.8; opacity: 0.8;}\t\t\t\t\t .twipsy.above .twipsy-arrow { bottom: 0; left: 50%; margin-left: -5px; border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 5px solid #000000;}\t\t\t\t\t .twipsy.left .twipsy-arrow { top: 50%; right: 0; margin-top: -5px; border-top: 5px solid transparent; border-bottom: 5px solid transparent; border-left: 5px solid #000000;}\t\t\t\t\t .twipsy.below .twipsy-arrow { top: 0; left: 50%; margin-left: -5px; border-left: 5px solid transparent; border-right: 5px solid transparent; border-bottom: 5px solid #000000;}\t\t\t\t\t .twipsy.right .twipsy-arrow { top: 50%; left: 0; margin-top: -5px; border-top: 5px solid transparent; border-bottom: 5px solid transparent; border-right: 5px solid #000000;}\t\t\t\t\t .twipsy-inner { padding: 3px 8px; background-color: #000000; color: white; text-align: center; max-width: 200px; text-decoration: none; -webkit-border-radius: 4px; -moz-border-radius: 4px; border-radius: 4px;}\t\t\t\t\t .twipsy-arrow { position: absolute; width: 0; height: 0;}",b=(new Element("style",{type:"text/css"})).inject(d("head"),"bottom");b.styleSheet?b.styleSheet.cssText=a:b.innerHTML=a}},i;typeOf(Browser.Features.transition)!="boolean"&&(Browser.Features.transition=function(){var b=(a.body||a.documentElement).style;return b.transition!==c||b.MsTransition!==c?f="TransitionEnd":b.WebkitTransition!==c?f="webkitTransitionEnd":b.MozTransition!==c?f="transitionend":b.OTransition!==c&&(f="oTransitionEnd"),f!=null}()),i=new Class({initialize:function(b,c){this.options=Object.merge({},i.defaults,c),this.element=a.id(b),this.enabled=!0,c.injectStyles&&h(),this.fixTitle()},show:function(){var a,b,c,d,f,g,h,i,j;if(this.hasContent()&&this.enabled){f=this.setContent().getTip(),this.options.animate&&f.addClass("twipsy-fade"),f.setStyles({top:0,left:0,display:"block"}).inject(document.body,"top"),h=this.element.getPosition(),i=this.element.getSize(),a={left:h.x,top:h.y,width:i.x,height:i.y},j=f.getSize(),b=j.x,c=j.y,d=e(this.options.placement,this,[f,this.element]);switch(d){case"below":g={top:a.top+a.height+this.options.offset,left:a.left+a.width/2-b/2};break;case"above":g={top:a.top-c-this.options.offset,left:a.left+a.width/2-b/2};break;case"left":g={top:a.top+a.height/2-c/2,left:a.left-b-this.options.offset};break;case"right":g={top:a.top+a.height/2-c/2,left:a.left+a.width+this.options.offset}}f.setStyles(g).addClass(d).addClass("twipsy-in")}return this},hide:function(){var a=this.getTip(),b=function(){a.parentNode.removeChild(a),Browser.Features.transition&&a.hasClass("twipsy-fade")&&a.removeEvents(f)};return a.removeClass("twipsy-in"),Browser.Features.transition&&a.hasClass("twipsy-fade")?a.addEvent(f,b):b(),this},setContent:function(){return this.getTip().getElement(".twipsy-inner").set(this.options.html?"html":"text",this.getTitle()),this},hasContent:function(){return this.getTitle().replace(/\s+/g,"")!=""},getTitle:function(){var a,b=this.element,c=this.options;return this.fixTitle(),typeof c.title=="string"?a=b.getProperty(c.title=="title"?"data-original-title":c.title):typeof c.title=="function"&&(a=c.title.call(b)),a=(""+a).clean(),a||c.fallback},getTip:function(){return this.tip||(this.tip=new Element("div.twipsy",{html:this.options.template})),this.tip},validate:function(){return this.element.parentNode?!0:(this.hide(),this.element=null,this.options=null,!1)},enable:function(){return this.enabled=!0,this},disable:function(){return this.enabled=!1,this},toggleEnabled:function(){return this.enabled=!this.enabled,this},toggle:function(){return this[this.getTip().hasClass("twipsy-in")?"hide":"show"](),this},fixTitle:function(){var a=this.element;return(a.getProperty("title")||!a.getProperty("data-original-title"))&&a.setProperty("data-original-title",a.getProperty("title")||"").removeProperty("title"),this}}),i.defaults={placement:"above",animate:!0,delayIn:0,delayOut:0,html:!1,live:!1,offset:0,title:"title",trigger:"hover",injectStyles:!0,fallback:"",template:'<div class="twipsy-inner"></div><div class="twipsy-arrow"></div>'},i.rejectAttrOptions=["title"],i.elementOptions=function(a,b){var c={},d=i.rejectAttrOptions,e=d.length;["placement","animate","delay-in","delay-out","html","offset","title","trigger","template","inject-styles"].each(function(b){var d=null,e;a.dataset?d=a.dataset[b.camelCase()]:d=a.getProperty("data-"+b),d&&(e=d.toLowerCase().clean(),e==="true"?d=!0:e==="false"?d=!1:/^[0-9]+$/.test(e)&&(d=d.toInt()),c[b.camelCase()]=d)});while(e--)delete c[d[e]];return Object.merge({},b,c)},Element.implement({twipsy:function(a){var b,c,d,e="twipsy",f=function(b){var c=b.retrieve(e);return c||(c=new i(b,i.elementOptions(b,a)),b.store(e,c)),c},g=function(){var b=f(this);b.hoverState="in",a.delayIn==0?b.show():(b.fixTitle(),setTimeout(function(){b.hoverState=="in"&&b.show()},a.delayIn))},h=function(){var b=f(this);b.hoverState="out",a.delayOut==0?b.hide():setTimeout(function(){b.hoverState=="out"&&b.hide()},a.delayOut)};return a===!0?this.retrieve(e):typeof a=="string"?(b=this.retrieve(e),b&&b[a](),this):(a=Object.merge({},i.defaults,a),a.trigger!="manual"&&(c=a.trigger=="hover"?"mouseenter":"focus",d=a.trigger=="hover"?"mouseleave":"blur",f(this),this.addEvent(c,g).addEvent(d,h)),this)}}),Elements.implement({twipsy:function(a){return this.each(function(b){b.twipsy(a)}),this}}),b.Twipsy=i})(document,self,undefined)
